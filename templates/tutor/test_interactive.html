
{% load i18n staticfiles %}

<!DOCTYPE html>
<html>
<head>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
    <script src="{% static 'javascript/csound.js' %}"></script>
</head>

<body>

<script src="{% static 'javascript/interactive_csound.js' %}"></script>

<p>Test name: {{ context.test_name }}</p>
<p>FX set: {{ context.effect_set }}</p>
<p>csd file: {{ context.csd }}</p>

{% for effect_name, effect_parameter_set in context.effect_set.items %}
	{% for parameter, values in effect_parameter_set.items %}
		<p>{{ parameter }}: <input class="slider" id="{{ effect_name }}_{{ parameter }}" type="range" min={{ values.1.0 }} max={{ values.1.1 }} value="{{ values.0 }}" step="0.001" /> </p>
	{% endfor %}

{% endfor %}

<script type="text/javascript">

	{% for effect_name, effect_parameter_set in context.effect_set.items %}
		{% for parameter, values in effect_parameter_set.items %}
		    $("#{{ effect_name }}_{{ parameter }}").on("input change", function() {
		        csound.SetChannel("{{ effect_name }}_{{ parameter }}", this.value);
		    });
		{% endfor %}
	{% endfor %}

    function moduleDidLoad() {
	    localStorage.clear();

	    // Load initial csd file
	    var csd_url = "/site_media/user/{{ context.csd }}";
	    var csd_name = "test.csd";

	    csound.CopyUrlToLocal(csd_url, csd_name);

	    // Load initial audio file
	    loadAudio("/site_media/system/samples/{{ context.sound }}");

	    // Start csound
	   	setTimeout(function() {
	    	csound.PlayCsd("local/test.csd");
    	}, 500);

	    // Set levels to hear only the target sound
	    csound.SetChannel("target_amplitude", 1.0);
	    csound.SetChannel("user_amplitude", 0.0);

	    // Initialize parameters
	    csound.SetChannel("param1", 0.5);
	    csound.SetChannel("param2", 5000);
	    csound.SetChannel("param3", 10);
	    csound.SetChannel("param4", 0.5);
	}

</script>


<input type="image" id="playPauseButton" src="{% static 'images/play.png' %}" style="outline: none;" />
<input type="button" id="switchInstanceButton" value="A/B">

<audio controls>
<source src="/site_media/system/samples/{{ context.sound }}" type="audio/wav">
</audio>

  <!-- csound message field -->
<div id="csound_message"> </div>

<!--pNaCl csound module -->
<div id="engine"></div>


</body>
</html>